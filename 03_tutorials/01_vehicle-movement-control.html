<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Vehicle Movement Control</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../00_installation/01_ros-installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../01_hardware/index.html"><strong aria-hidden="true">2.</strong> Hardware</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../01_hardware/01_pcb.html"><strong aria-hidden="true">2.1.</strong> PCB</a></li><li class="chapter-item expanded "><a href="../01_hardware/02_schematic.html"><strong aria-hidden="true">2.2.</strong> Schematic</a></li></ol></li><li class="chapter-item expanded "><a href="../02_software/index.html"><strong aria-hidden="true">3.</strong> Software</a></li><li class="chapter-item expanded "><a href="../03_tutorials/index.html"><strong aria-hidden="true">4.</strong> Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../03_tutorials/01_vehicle-movement-control.html" class="active"><strong aria-hidden="true">4.1.</strong> Vehicle Movement Control</a></li><li class="chapter-item expanded "><a href="../03_tutorials/02_ros-node-topics.html"><strong aria-hidden="true">4.2.</strong> ROS Node Topics</a></li><li class="chapter-item expanded "><a href="../03_tutorials/03_odometer-calibration.html"><strong aria-hidden="true">4.3.</strong> Odometer Calibration</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="vehicle-movement-control"><a class="header" href="#vehicle-movement-control">Vehicle Movement Control</a></h1>
<h2 id="step-1-add-serial-user-group"><a class="header" href="#step-1-add-serial-user-group">Step 1: Add Serial User Group</a></h2>
<ol>
<li>
<p><strong>Check Driver Board Connection</strong>
Enter the command <code>ls /dev</code> on the Jetson Nano to check whether the driver board is connected to Jetson Nano normally and whether ttyACM0 and ttyACM1 devices are found.</p>
<ul>
<li><code>ttyACM0</code> is used to communicate with the microcontroller.</li>
<li><code>ttyACM1</code> is used to communicate with the radar.</li>
</ul>
<pre><code class="language-bash">ls /dev
</code></pre>
</li>
<li>
<p><strong>Add the Serial Port User Group</strong>
Enter the following commands to add the serial port user group. If you are using a configured system with already added permissions, you can skip this step.</p>
<pre><code class="language-bash">ls -l /dev/ttyACM*            # View the serial port user group as dialout
id -Gn                        # View the user groups that the current user belongs to, the first one is the current user
sudo adduser jetbot dialout   # Add the current user to the user group dialout where the serial port is located
</code></pre>
</li>
<li>
<p><strong>Restart Jetson Nano</strong>
Enter the command <code>sudo reboot</code> to restart. The password is <code>jetson</code>.</p>
<pre><code class="language-bash">sudo reboot   # Restart Jetson Nano
</code></pre>
<p><strong>Note</strong>: The addition of the user to the dialout group takes effect only after restarting. Without serial port permissions, the robot chassis node will report an error after booting up.</p>
</li>
</ol>
<h2 id="step-2-start-the-robot-chassis-control-node"><a class="header" href="#step-2-start-the-robot-chassis-control-node">Step 2: Start the Robot Chassis Control Node</a></h2>
<ol>
<li>
<p><strong>Start the Robot Master Node</strong>
Connect to the robot via SSH, open the terminal, and enter the following command to start the robot master node.</p>
<pre><code class="language-bash">roscore   # Start the robot master node
</code></pre>
</li>
<li>
<p><strong>Start the Robot Chassis Node</strong>
Enter the following command to start the robot chassis node. The command will also automatically start the master node if it’s not already running.</p>
<pre><code class="language-bash">roslaunch jetracer jetracer.launch   # Start the robot chassis node
</code></pre>
</li>
<li>
<p><strong>Verify Multi-Machine Communication</strong>
Open the Ubuntu virtual machine terminal and enter the following command to verify that the multi-machine communication connection is normal.</p>
<pre><code class="language-bash">rostopic list
</code></pre>
<p>If the expected topics appear, multi-device communication is successful. If not, recheck the IP and hostname configurations and ensure they are connected to the same WiFi.</p>
<ul>
<li><code>/cmd_vel</code>: Robot movement control topic.</li>
<li><code>/imu</code>: Robot IMU topic.</li>
<li><code>/motor/*</code>: Actual encoded speed and set speed of the left and right motors.</li>
<li><code>/odom</code>: Robot odometer.</li>
<li><code>/odom_combined</code>: Robot fusion odometer, combining encoded odometer with IMU data.</li>
</ul>
</li>
</ol>
<h2 id="step-3-start-topic-publishing-node-control"><a class="header" href="#step-3-start-topic-publishing-node-control">Step 3: Start Topic Publishing Node Control</a></h2>
<ol>
<li>
<p><strong>Start the Topic Publishing Node</strong>
Keep the robot chassis node running and place the car on the ground. Open a terminal in the Ubuntu virtual machine and enter the following command.</p>
<pre><code class="language-bash">rosrun rqt_publisher rqt_publisher   # Start topic publishing node
</code></pre>
</li>
<li>
<p><strong>Publish a Topic</strong>
In the pop-up window, select the topic <code>/cmd_vel</code> and click "+" to create a new topic. Configure the following:</p>
<ul>
<li><code>linear-&gt;x</code>: Linear speed of the robot (-1.2m/s to 1.2m/s)</li>
<li><code>angular-&gt;z</code>: Steering angle of the robot’s front tires (-0.6 radians to 0.6 radians)</li>
</ul>
<p>Change <code>linear.x</code> to 0.5, right-click, and select "Publish selected once" to make the robot move forward 0.5 meters. Setting <code>linear.x</code> to 0 and <code>angular.z</code> to 0.6 will make the robot turn left.</p>
<p><strong>Note</strong>: Ensure to select the <code>Twist</code> type for <code>/cmd_vel</code>.</p>
</li>
<li>
<p><strong>Close the Topic Publishing Node</strong>
Press <code>Ctrl+C</code> to close the topic publishing node.</p>
</li>
<li>
<p><strong>View Topic Information</strong>
Re-open a terminal on the robot side and enter the following command to view the topic information of the car movement.</p>
<pre><code class="language-bash">rostopic echo /cmd_vel   # Display /cmd_vel topic
</code></pre>
<p><strong>Special Note</strong>: <code>angular-&gt;z</code> is the steering angle of the robot's tires, not the angular velocity.</p>
</li>
</ol>
<h2 id="step-4-control-the-robot-movement-with-keyboard"><a class="header" href="#step-4-control-the-robot-movement-with-keyboard">Step 4: Control the Robot Movement with Keyboard</a></h2>
<ol>
<li>
<p><strong>Open Keyboard Control Topic Node</strong>
Press <code>Ctrl+Alt+t</code> on the Ubuntu virtual machine to open a new terminal and enter the following command.</p>
<pre><code class="language-bash">roslaunch jetracer keyboard.launch
</code></pre>
</li>
<li>
<p><strong>Control the Robot</strong>
Use the arrow keys to control the robot’s movement. The movement data can be viewed in the topics received by the robot terminal.</p>
</li>
<li>
<p><strong>Interrupt Node Running</strong>
Press <code>Ctrl+C</code> to stop the node.</p>
<p><strong>Note</strong>: The controls are only valid when the robot master node and the robot chassis node are activated. If the robot does not respond, check the node operation and multi-machine communication.</p>
</li>
</ol>
<h2 id="step-5-connect-the-virtual-machine-to-the-gamepad-control"><a class="header" href="#step-5-connect-the-virtual-machine-to-the-gamepad-control">Step 5: Connect the Virtual Machine to the Gamepad Control</a></h2>
<ol>
<li>
<p><strong>Check Gamepad Connection</strong>
Connect the USB receiver of the gamepad to the computer. A box will pop up, select "Connect to Virtual Machine -&gt; Ubuntu JetRacer."</p>
</li>
<li>
<p><strong>Test Gamepad Connection</strong>
Run the following command in the virtual machine to check if the gamepad is connected.</p>
<pre><code class="language-bash">ls /dev/input/
</code></pre>
<p><code>js0</code> represents the game joystick handle. Run the following command to test the game handle.</p>
<pre><code class="language-bash">jstest /dev/input/js0
</code></pre>
<p>Press different buttons on the remote control handle to verify the corresponding button values change.</p>
</li>
<li>
<p><strong>Start Gamepad Control Node</strong>
Enter the following command in the virtual machine to start the gamepad control node.</p>
<pre><code class="language-bash">roslaunch jetracer joy.launch
</code></pre>
</li>
<li>
<p><strong>Control the Robot with Gamepad</strong>
Turn on the power of the handle, press the HOME button, and a red light will turn on. Press and hold the L1 button while controlling the left joystick for steering and the right joystick for forward and backward movement. Release the L1 key to stop the robot.</p>
<p><strong>Note</strong>: If the remote control fails, open the program file to adjust the values.</p>
<pre><code class="language-bash">sudo nano ~/catkin_ws/src/jetracer_ros/scripts/teleop_joy.py   # Open the remote control program file
</code></pre>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../03_tutorials/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../03_tutorials/02_ros-node-topics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../03_tutorials/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../03_tutorials/02_ros-node-topics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
